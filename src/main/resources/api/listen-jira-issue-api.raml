#%RAML 1.0
title: Jira Issue Update Webhook Listener API
version: v1
baseUri: /api/{version}

mediaType: application/json

documentation:
  - title: Overview
    content: |
      This endpoint receives Jira webhooks for issue events, specifically filtering for updates on non-subtask issues, and then updates the corresponding Salesforce Opportunity using custom field (customfield_10105) as the Opportunity ID.

/listenToJiraIssueWebhook:
  post:
    displayName: Listen to Jira Issue Update
    description: Receives a Jira webhook payload and updates a linked Salesforce Opportunity based on issue key and field values.
    body:
      application/json:
        type: object
        properties:
          issue_event_type_name:
            type: string
            enum: [issue_updated]
            description: Must be 'issue_updated' to proceed.
          issue:
            type: object
            properties:
              key:
                type: string
                description: The Jira issue key (e.g., SCRUM-1).
              fields:
                type: object
                properties:
                  issuetype:
                    type: object
                    properties:
                      subtask:
                        type: boolean
                        enum: [false]
                        description: Must be 'false' to process.
                  customfield_10105:
                    type: string
                    description: Salesforce Opportunity ID.
                  summary:
                    type: string
                  description:
                    type: object
                  status:
                    type: object
                    properties:
                      name:
                        type: string
                  duedate:
                    type: date-only
                  customfield_10108:
                    type: number
                    description: Opportunity Amount.
                  priority:
                    type: object
                    properties:
                      name:
                        type: string
                        enum: [Highest, High, Medium, Low, Lowest]
                        description: Mapped to Opportunity Probability.
                  assignee:
                    type: object
                    properties:
                      emailAddress:
                        type: string
    responses:
      200:
        description: None
        body: null